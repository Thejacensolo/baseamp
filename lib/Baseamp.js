// Generated by CoffeeScript 1.7.1
(function() {
  var Api, Baseamp, TodoLists, Util, debug, pjson, util, _;

  util = require("util");

  _ = require("underscore");

  debug = require("debug")("Baseamp:Baseamp");

  TodoLists = require("./TodoLists");

  Util = require("./Util");

  Api = require("./Api");

  pjson = require("../package.json");

  Baseamp = (function() {
    function Baseamp(config) {
      this.api = new Api(config);
    }

    Baseamp.prototype.version = function(file, cb) {
      var stderr, stdout;
      stdout = "";
      stderr = "";
      stderr += "v" + pjson.version;
      return cb(null, stdout, stderr);
    };

    Baseamp.prototype.help = function(file, cb) {
      var stderr, stdout;
      stdout = "";
      stderr = "";
      stderr += "" + pjson.name + " v" + pjson.version + "\n";
      stderr += " \n";
      stderr += " Usage:\n";
      stderr += " \n";
      stderr += "   " + pjson.name + " action [args]\n";
      stderr += " \n";
      stderr += " Actions:\n";
      stderr += " \n";
      stderr += "   import [file]  Downloads latest todos from Basecamp, saved to file or STDOUT(-)\n";
      stderr += "   export [file]  Uploads latest todos to Basecamp, sourcing from file or STDIN(-)\n";
      stderr += "  version         Reports version\n";
      stderr += "     help         This page\n";
      return cb(null, stdout, stderr);
    };

    Baseamp.prototype["import"] = function(file, cb) {
      return this.api.getTodoLists(function(err, todoLists) {
        var buf, stderr, stdout;
        if (err) {
          return cb(err);
        }
        todoLists = new TodoLists(todoLists);
        buf = todoLists.toMarkdown();
        if (file === "-") {
          stderr = "";
          stdout = buf;
        } else {
          stderr = "Writing todo to " + file + "\n";
          stdout = "";
          fs.writeFileSync(file, stdout, "utf-8");
        }
        return cb(null, stdout, stderr);
      });
    };

    Baseamp.prototype["export"] = function(file, cb) {
      var buf, todoLists;
      buf = fs.readFileSync(file, "utf-8");
      todoLists = new TodoLists(buf);
      debug(util.inspect({
        todoLists: todoLists,
        todoList: todoLists.lists[0]
      }));
      return cb(null, "winning");
    };

    return Baseamp;

  })();

  module.exports = Baseamp;

}).call(this);
